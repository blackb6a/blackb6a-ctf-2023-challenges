

# This file was *autogenerated* from the file rev_mt2.sage
from sage.all_cmdline import *   # import sage library

_sage_const_2 = Integer(2); _sage_const_1 = Integer(1); _sage_const_64 = Integer(64); _sage_const_29 = Integer(29); _sage_const_0x5555555555555555 = Integer(0x5555555555555555); _sage_const_17 = Integer(17); _sage_const_0x71d67fffeda60000 = Integer(0x71d67fffeda60000); _sage_const_37 = Integer(37); _sage_const_0xfff7eee000000000 = Integer(0xfff7eee000000000); _sage_const_43 = Integer(43); _sage_const_0xb5026f5aa96619e9 = Integer(0xb5026f5aa96619e9); _sage_const_312 = Integer(312); _sage_const_31 = Integer(31); _sage_const_156 = Integer(156); _sage_const_0 = Integer(0); _sage_const_20000 = Integer(20000); _sage_const_100 = Integer(100); _sage_const_69 = Integer(69); _sage_const_14850285750109030178 = Integer(14850285750109030178); _sage_const_2433108913545666511 = Integer(2433108913545666511); _sage_const_12165442406605326438 = Integer(12165442406605326438); _sage_const_16492750041495246232 = Integer(16492750041495246232); _sage_const_5985953121957622084 = Integer(5985953121957622084); _sage_const_14134967652723287079 = Integer(14134967652723287079); _sage_const_6469697030762821211 = Integer(6469697030762821211); _sage_const_12273613955114562522 = Integer(12273613955114562522); _sage_const_17259661581098255617 = Integer(17259661581098255617); _sage_const_16973225129691209572 = Integer(16973225129691209572); _sage_const_1671298410160447014 = Integer(1671298410160447014); _sage_const_2766666917229815482 = Integer(2766666917229815482); _sage_const_18152002698090042559 = Integer(18152002698090042559); _sage_const_6109896619580762394 = Integer(6109896619580762394); _sage_const_4424171998734786254 = Integer(4424171998734786254); _sage_const_14659121728155851846 = Integer(14659121728155851846); _sage_const_4021794363582100274 = Integer(4021794363582100274); _sage_const_1190070720064998876 = Integer(1190070720064998876); _sage_const_17113031305806140351 = Integer(17113031305806140351); _sage_const_7820767439185607712 = Integer(7820767439185607712); _sage_const_15761607804592599266 = Integer(15761607804592599266); _sage_const_10763736708310709923 = Integer(10763736708310709923); _sage_const_3652440110184888676 = Integer(3652440110184888676); _sage_const_16291849719008916140 = Integer(16291849719008916140); _sage_const_13531546450086099420 = Integer(13531546450086099420); _sage_const_10689944842290892320 = Integer(10689944842290892320); _sage_const_17550741367948958229 = Integer(17550741367948958229); _sage_const_5049524925867114490 = Integer(5049524925867114490); _sage_const_9085915584417350716 = Integer(9085915584417350716); _sage_const_2324128091746255319 = Integer(2324128091746255319); _sage_const_16182223945900014570 = Integer(16182223945900014570); _sage_const_12816883904370089749 = Integer(12816883904370089749); _sage_const_6338495201003790380 = Integer(6338495201003790380); _sage_const_690019768251267851 = Integer(690019768251267851); _sage_const_11001203236598502930 = Integer(11001203236598502930); _sage_const_14483016109909577972 = Integer(14483016109909577972); _sage_const_3184981331538216080 = Integer(3184981331538216080); _sage_const_1953735306623729014 = Integer(1953735306623729014); _sage_const_3195912717810554853 = Integer(3195912717810554853); _sage_const_6727899073777700457 = Integer(6727899073777700457); _sage_const_14381881870900469873 = Integer(14381881870900469873); _sage_const_13948313970526077492 = Integer(13948313970526077492); _sage_const_1898363474447101142 = Integer(1898363474447101142); _sage_const_10158150047307123658 = Integer(10158150047307123658); _sage_const_3289353210223069781 = Integer(3289353210223069781); _sage_const_2924631213903838239 = Integer(2924631213903838239); _sage_const_12016550281043489442 = Integer(12016550281043489442); _sage_const_5288037825798194768 = Integer(5288037825798194768); _sage_const_1928511066588121966 = Integer(1928511066588121966); _sage_const_4262384579588166792 = Integer(4262384579588166792); _sage_const_8303760917298254875 = Integer(8303760917298254875); _sage_const_12691505544580951750 = Integer(12691505544580951750); _sage_const_10256275383962973353 = Integer(10256275383962973353); _sage_const_3231843563599501125 = Integer(3231843563599501125); _sage_const_14248865832675791448 = Integer(14248865832675791448); _sage_const_6248696301809803063 = Integer(6248696301809803063); _sage_const_13789104089182029495 = Integer(13789104089182029495); _sage_const_5843607658742135051 = Integer(5843607658742135051); _sage_const_17737777857298791677 = Integer(17737777857298791677); _sage_const_1619724124746087138 = Integer(1619724124746087138); _sage_const_14726661911679743991 = Integer(14726661911679743991); _sage_const_9857656590077387298 = Integer(9857656590077387298); _sage_const_6180484366290558943 = Integer(6180484366290558943); _sage_const_10323036535346379846 = Integer(10323036535346379846); _sage_const_15793517081317299253 = Integer(15793517081317299253); _sage_const_1266408713076512704 = Integer(1266408713076512704); _sage_const_16933434268416011523 = Integer(16933434268416011523); _sage_const_17261828307174336836 = Integer(17261828307174336836); _sage_const_13654271599404317376 = Integer(13654271599404317376); _sage_const_13402228851820876384 = Integer(13402228851820876384); _sage_const_2849994893206821249 = Integer(2849994893206821249); _sage_const_12151288158736186101 = Integer(12151288158736186101); _sage_const_1169145218531206836 = Integer(1169145218531206836); _sage_const_741819289445341678 = Integer(741819289445341678); _sage_const_7734691436031090977 = Integer(7734691436031090977); _sage_const_11798452477212373740 = Integer(11798452477212373740); _sage_const_7154217834858219043 = Integer(7154217834858219043); _sage_const_17106406639752114760 = Integer(17106406639752114760); _sage_const_9038218857931263102 = Integer(9038218857931263102); _sage_const_17629303477546251171 = Integer(17629303477546251171); _sage_const_9561911214626190193 = Integer(9561911214626190193); _sage_const_5819230377587513481 = Integer(5819230377587513481); _sage_const_17692394905852954683 = Integer(17692394905852954683); _sage_const_16584678928098916908 = Integer(16584678928098916908); _sage_const_9552629934797441944 = Integer(9552629934797441944); _sage_const_1960578554505310312 = Integer(1960578554505310312); _sage_const_5314126755454229151 = Integer(5314126755454229151); _sage_const_10420019664327839774 = Integer(10420019664327839774); _sage_const_1920579974014384453 = Integer(1920579974014384453); _sage_const_11814572504873913467 = Integer(11814572504873913467); _sage_const_6813620197529319584 = Integer(6813620197529319584); _sage_const_14530818300613956521 = Integer(14530818300613956521); _sage_const_5717960335638514495 = Integer(5717960335638514495); _sage_const_1826089317315542084 = Integer(1826089317315542084); _sage_const_9746540325693920339 = Integer(9746540325693920339); _sage_const_12293903579751661981 = Integer(12293903579751661981); _sage_const_12072023852027505236 = Integer(12072023852027505236); _sage_const_4158161956491320192 = Integer(4158161956491320192); _sage_const_13187797178028234211 = Integer(13187797178028234211); _sage_const_10347220378338392049 = Integer(10347220378338392049); _sage_const_4109685635204129564 = Integer(4109685635204129564); _sage_const_17905396678924636242 = Integer(17905396678924636242); _sage_const_12816169692784168356 = Integer(12816169692784168356); _sage_const_3122202157254754454 = Integer(3122202157254754454); _sage_const_15049344592201270471 = Integer(15049344592201270471); _sage_const_11743069746039313118 = Integer(11743069746039313118); _sage_const_5518361885899535639 = Integer(5518361885899535639); _sage_const_5523064766773051210 = Integer(5523064766773051210); _sage_const_13099261390903694748 = Integer(13099261390903694748); _sage_const_15735208550749564724 = Integer(15735208550749564724); _sage_const_4954808013047354906 = Integer(4954808013047354906); _sage_const_8530172943937275951 = Integer(8530172943937275951); _sage_const_6039486853166908039 = Integer(6039486853166908039); _sage_const_17250917600359853056 = Integer(17250917600359853056); _sage_const_16884230491275901434 = Integer(16884230491275901434); _sage_const_7146627352729827385 = Integer(7146627352729827385); _sage_const_5377079253085891149 = Integer(5377079253085891149); _sage_const_11325711945158075346 = Integer(11325711945158075346); _sage_const_1175841450242341895 = Integer(1175841450242341895); _sage_const_3536321062507234995 = Integer(3536321062507234995); _sage_const_17987804153441270512 = Integer(17987804153441270512); _sage_const_13005249981618285105 = Integer(13005249981618285105); _sage_const_788148126685329522 = Integer(788148126685329522); _sage_const_11570339277811300998 = Integer(11570339277811300998); _sage_const_18165650536299414961 = Integer(18165650536299414961); _sage_const_18232708859827982024 = Integer(18232708859827982024); _sage_const_16349646165263929134 = Integer(16349646165263929134); _sage_const_12066432301769178729 = Integer(12066432301769178729); _sage_const_6487193457298837072 = Integer(6487193457298837072); _sage_const_229428936786228159 = Integer(229428936786228159); _sage_const_18318805619883399702 = Integer(18318805619883399702); _sage_const_7278903377176379701 = Integer(7278903377176379701); _sage_const_354652449667105449 = Integer(354652449667105449); _sage_const_5081617143372943163 = Integer(5081617143372943163); _sage_const_7497558559813792697 = Integer(7497558559813792697); _sage_const_4724303652352827360 = Integer(4724303652352827360); _sage_const_14904849903329294870 = Integer(14904849903329294870); _sage_const_9654616591528403259 = Integer(9654616591528403259); _sage_const_7868294853033500304 = Integer(7868294853033500304); _sage_const_18377173560417505033 = Integer(18377173560417505033); _sage_const_6775725803195226959 = Integer(6775725803195226959); _sage_const_8023923270416842564 = Integer(8023923270416842564); _sage_const_16062558331775015600 = Integer(16062558331775015600); _sage_const_12622106697264283399 = Integer(12622106697264283399); _sage_const_16791480129290997618 = Integer(16791480129290997618); _sage_const_9642624528887989871 = Integer(9642624528887989871); _sage_const_5568699880367158460 = Integer(5568699880367158460); _sage_const_2292132947419875533 = Integer(2292132947419875533); _sage_const_2860843525364350878 = Integer(2860843525364350878); _sage_const_15044875604876382556 = Integer(15044875604876382556); _sage_const_2322206644710534986 = Integer(2322206644710534986); _sage_const_7994086170589054618 = Integer(7994086170589054618); _sage_const_18221232115843518168 = Integer(18221232115843518168); _sage_const_17932509913338872345 = Integer(17932509913338872345); _sage_const_16745957960550270253 = Integer(16745957960550270253); _sage_const_3041547535235218354 = Integer(3041547535235218354); _sage_const_6052294403885337831 = Integer(6052294403885337831); _sage_const_14097508762821320460 = Integer(14097508762821320460); _sage_const_7722979236945438530 = Integer(7722979236945438530); _sage_const_5412312762183033959 = Integer(5412312762183033959); _sage_const_4330257397020393615 = Integer(4330257397020393615); _sage_const_14066425088243174085 = Integer(14066425088243174085); _sage_const_5908415129829941105 = Integer(5908415129829941105); _sage_const_14613827790321653588 = Integer(14613827790321653588); _sage_const_10392847639868851184 = Integer(10392847639868851184); _sage_const_17319939956249493552 = Integer(17319939956249493552); _sage_const_5471647358638282398 = Integer(5471647358638282398); _sage_const_4323805273413622683 = Integer(4323805273413622683); _sage_const_45673835583717352 = Integer(45673835583717352); _sage_const_2768951858098230386 = Integer(2768951858098230386); _sage_const_10533333615840814773 = Integer(10533333615840814773); _sage_const_5792976824891660247 = Integer(5792976824891660247); _sage_const_6760470939962645323 = Integer(6760470939962645323); _sage_const_12059043970688713392 = Integer(12059043970688713392); _sage_const_1141514292704724985 = Integer(1141514292704724985); _sage_const_14376006554387754613 = Integer(14376006554387754613); _sage_const_7848659205171623279 = Integer(7848659205171623279); _sage_const_2102102900942141192 = Integer(2102102900942141192); _sage_const_3226835475814606107 = Integer(3226835475814606107); _sage_const_14939040302529096563 = Integer(14939040302529096563); _sage_const_4886941580894909285 = Integer(4886941580894909285); _sage_const_16293689027031803210 = Integer(16293689027031803210); _sage_const_15262468573549282700 = Integer(15262468573549282700); _sage_const_10155481829793770459 = Integer(10155481829793770459); _sage_const_17540686337364843742 = Integer(17540686337364843742); _sage_const_9359123964020029075 = Integer(9359123964020029075); _sage_const_14341050618119309112 = Integer(14341050618119309112); _sage_const_12507168617459174171 = Integer(12507168617459174171); _sage_const_18130902956048423714 = Integer(18130902956048423714); _sage_const_13665444396961473675 = Integer(13665444396961473675); _sage_const_15046176000598795220 = Integer(15046176000598795220); _sage_const_17555217830165395083 = Integer(17555217830165395083); _sage_const_13911393252134719145 = Integer(13911393252134719145); _sage_const_7231927861169253028 = Integer(7231927861169253028); _sage_const_9656800224326818500 = Integer(9656800224326818500); _sage_const_16619073847145426834 = Integer(16619073847145426834); _sage_const_9362500945733192770 = Integer(9362500945733192770); _sage_const_16248043795163080710 = Integer(16248043795163080710); _sage_const_17119492047852061864 = Integer(17119492047852061864); _sage_const_3771777233785612247 = Integer(3771777233785612247); _sage_const_5066099564990360212 = Integer(5066099564990360212); _sage_const_6528217348327614459 = Integer(6528217348327614459); _sage_const_14557732355667791293 = Integer(14557732355667791293); _sage_const_3983967235049499954 = Integer(3983967235049499954); _sage_const_14972865518559772823 = Integer(14972865518559772823); _sage_const_18309892963862300370 = Integer(18309892963862300370); _sage_const_2702565340066128524 = Integer(2702565340066128524); _sage_const_14581826585510807404 = Integer(14581826585510807404); _sage_const_6785923105704665172 = Integer(6785923105704665172); _sage_const_3178783832504015555 = Integer(3178783832504015555); _sage_const_4487329387126092314 = Integer(4487329387126092314); _sage_const_14607659555773674854 = Integer(14607659555773674854); _sage_const_14611690777913540246 = Integer(14611690777913540246); _sage_const_8650469441940155399 = Integer(8650469441940155399); _sage_const_16395201898136500197 = Integer(16395201898136500197); _sage_const_17054554322277903942 = Integer(17054554322277903942); _sage_const_8808727791174901242 = Integer(8808727791174901242); _sage_const_4659912545766869753 = Integer(4659912545766869753); _sage_const_16280093529780582003 = Integer(16280093529780582003); _sage_const_8227777100883485324 = Integer(8227777100883485324); _sage_const_6391648914081892006 = Integer(6391648914081892006); _sage_const_8086830636050859321 = Integer(8086830636050859321); _sage_const_3036329342931530679 = Integer(3036329342931530679); _sage_const_9550803986416279819 = Integer(9550803986416279819); _sage_const_15723715638974760566 = Integer(15723715638974760566); _sage_const_3600131081381178995 = Integer(3600131081381178995); _sage_const_4213008057754089498 = Integer(4213008057754089498); _sage_const_7800227656146748278 = Integer(7800227656146748278); _sage_const_16093206001476543952 = Integer(16093206001476543952); _sage_const_34092242650846205 = Integer(34092242650846205); _sage_const_10796394235992786784 = Integer(10796394235992786784); _sage_const_3737507590365686562 = Integer(3737507590365686562); _sage_const_4635293704024224739 = Integer(4635293704024224739); _sage_const_6248356048367582628 = Integer(6248356048367582628); _sage_const_58651963418898924 = Integer(58651963418898924); _sage_const_7311945926270131048 = Integer(7311945926270131048); _sage_const_14172021054058588514 = Integer(14172021054058588514); _sage_const_786669623303546363 = Integer(786669623303546363); _sage_const_13707605466632827662 = Integer(13707605466632827662); _sage_const_12652037425211239948 = Integer(12652037425211239948); _sage_const_3614621764645931879 = Integer(3614621764645931879); _sage_const_14219218441530235661 = Integer(14219218441530235661); _sage_const_17705085596277634153 = Integer(17705085596277634153); _sage_const_10999205772563189142 = Integer(10999205772563189142); _sage_const_14725863541120225273 = Integer(14725863541120225273); _sage_const_16572032274137847272 = Integer(16572032274137847272); _sage_const_7422663040433123398 = Integer(7422663040433123398); _sage_const_1367429326763685491 = Integer(1367429326763685491); _sage_const_18188880427089780784 = Integer(18188880427089780784); _sage_const_3020113589899409137 = Integer(3020113589899409137); _sage_const_17861326137394640984 = Integer(17861326137394640984); _sage_const_12811521970281811451 = Integer(12811521970281811451); _sage_const_9930017077979937986 = Integer(9930017077979937986); _sage_const_14010209903230004926 = Integer(14010209903230004926); _sage_const_14244903658037443384 = Integer(14244903658037443384); _sage_const_5104596873780686687 = Integer(5104596873780686687); _sage_const_6541450802991281799 = Integer(6541450802991281799); _sage_const_11274015481877303440 = Integer(11274015481877303440); _sage_const_9263644877386569901 = Integer(9263644877386569901); _sage_const_2094508980097214663 = Integer(2094508980097214663); _sage_const_9265217547056391424 = Integer(9265217547056391424); _sage_const_12891725173846409312 = Integer(12891725173846409312); _sage_const_7368085360949604417 = Integer(7368085360949604417); _sage_const_17218569647880682568 = Integer(17218569647880682568); _sage_const_971578709965983544 = Integer(971578709965983544); _sage_const_18068295194496415202 = Integer(18068295194496415202); _sage_const_11447673531710052504 = Integer(11447673531710052504); _sage_const_1050990749156555294 = Integer(1050990749156555294); _sage_const_6617961706988870227 = Integer(6617961706988870227); _sage_const_8573699778506182520 = Integer(8573699778506182520); _sage_const_18351382407965474900 = Integer(18351382407965474900); _sage_const_11818212571937159515 = Integer(11818212571937159515); _sage_const_13279942519919393974 = Integer(13279942519919393974); _sage_const_2917195483987343542 = Integer(2917195483987343542); _sage_const_5267380285004415761 = Integer(5267380285004415761); _sage_const_6838848714000104164 = Integer(6838848714000104164); _sage_const_17641263518300288598 = Integer(17641263518300288598); _sage_const_2215745899135842567 = Integer(2215745899135842567); _sage_const_12801347909799411794 = Integer(12801347909799411794); _sage_const_10290562142964170536 = Integer(10290562142964170536); _sage_const_7914162112720597371 = Integer(7914162112720597371); _sage_const_887945320632678796 = Integer(887945320632678796); _sage_const_7498884365341905591 = Integer(7498884365341905591); _sage_const_6837169369110795546 = Integer(6837169369110795546); _sage_const_12081337382906878940 = Integer(12081337382906878940); _sage_const_10170622662080121124 = Integer(10170622662080121124); _sage_const_4164483125943285453 = Integer(4164483125943285453); _sage_const_16714749428117493289 = Integer(16714749428117493289); _sage_const_6397906319726017667 = Integer(6397906319726017667); _sage_const_17269200682146128380 = Integer(17269200682146128380); _sage_const_7643408118607526902 = Integer(7643408118607526902); _sage_const_13606395898320721039 = Integer(13606395898320721039); _sage_const_3995636887459959022 = Integer(3995636887459959022); _sage_const_2399445660061961468 = Integer(2399445660061961468); _sage_const_3356471279068499315 = Integer(3356471279068499315); _sage_const_17457407818660850527 = Integer(17457407818660850527); _sage_const_8387841308984493141 = Integer(8387841308984493141); _sage_const_9827685184581644270 = Integer(9827685184581644270); _sage_const_122379904170852775 = Integer(122379904170852775); _sage_const_6361209092488635527 = Integer(6361209092488635527); _sage_const_10367030262445106875 = Integer(10367030262445106875); _sage_const_6815142494923282099 = Integer(6815142494923282099); _sage_const_12700609328551660665 = Integer(12700609328551660665); _sage_const_12995076509576312783 = Integer(12995076509576312783); _sage_const_4314859466640917306 = Integer(4314859466640917306); _sage_const_7425591798559758436 = Integer(7425591798559758436); _sage_const_4258930916333954548 = Integer(4258930916333954548); _sage_const_12756686654123292952 = Integer(12756686654123292952); _sage_const_4264489197639561415 = Integer(4264489197639561415); _sage_const_15190066733707627825 = Integer(15190066733707627825); _sage_const_2083158051121733889 = Integer(2083158051121733889); _sage_const_63 = Integer(63); _sage_const_1000 = Integer(1000)
import re
import glob
from tqdm import tqdm, trange

EMPTY = set()
state = None

def add(v1, v2):
    return [x ^ y for x, y in zip(v1, v2)]

def int64_to_vec(x):
    return vector(GF(_sage_const_2 ), [(x >> i) & _sage_const_1  for i in range(_sage_const_64 )])

def vec_to_int64(x):
    return sum(ZZ(x.get(i)) << i for i in range(_sage_const_64 ))

def _lshift_vec(vec, k):
    return [EMPTY] * k + list(vec)[:-k]

def _rshift_vec(vec, k):
    return list(vec)[k:] + [EMPTY] * k

def _mask_mask(vec, mask):
    _mask = int64_to_vec(mask)
    return [vec[i] if k else EMPTY for i, k in enumerate(_mask)]

def _mask_const(term, const):
    _mask = int64_to_vec(const)
    return [term if k else EMPTY for k in _mask]

def _process_vec(y):
    y = add(y, _mask_mask(_rshift_vec(y, _sage_const_29 ), _sage_const_0x5555555555555555 ))
    y = add(y, _mask_mask(_lshift_vec(y, _sage_const_17 ), _sage_const_0x71d67fffeda60000 ))
    y = add(y, _mask_mask(_lshift_vec(y, _sage_const_37 ), _sage_const_0xfff7eee000000000 ))
    y = add(y, _rshift_vec(y, _sage_const_43 ))
    return y

const = _sage_const_0xb5026f5aa96619e9 

def twist():
    global state
    print("[+] twist()", flush=True)
    for i in range(_sage_const_312 ):
        # print("[*]", state[i], state[(i + 1) % 312], flush=True)
        # y = _mask_mask(state[(i + 1) % 312], lower) + _mask_mask(state[i], upper)
        state[i] = state[(i + _sage_const_1 ) % _sage_const_312 ][_sage_const_1 :_sage_const_31 ] + state[i][_sage_const_31 :] + [EMPTY]
        state[i] = add(state[i], state[(i + _sage_const_156 ) % _sage_const_312 ])
        state[i] = add(state[i], _mask_const(state[(i + _sage_const_1 ) % _sage_const_312 ][_sage_const_0 ], const))

def main():
    global state

    print("Loading data", flush=True)
    with open("public/output_69.txt", "r") as fin:
        ct = bytes.fromhex(fin.readline().split(" = ")[_sage_const_1 ].strip())
        iv = bytes.fromhex(fin.readline().split(" = ")[_sage_const_1 ].strip())
        iv = int.from_bytes(iv, "big")
    
    bits = [None] * _sage_const_64  + list(map(int, bin(iv)[_sage_const_2 :].zfill(_sage_const_20000  - _sage_const_64 )[::-_sage_const_1 ]))
    print("bits:", bits[:_sage_const_100 ], flush=True)

    print("Initialising variables", flush=True)
    
    state = [[{i * _sage_const_64  + j} for j in range(_sage_const_64 )] for i in range(_sage_const_312 )]

    # :eyes:
    correct_state = [_sage_const_69 , _sage_const_14850285750109030178 , _sage_const_2433108913545666511 , _sage_const_12165442406605326438 , _sage_const_16492750041495246232 , _sage_const_5985953121957622084 , _sage_const_14134967652723287079 , _sage_const_6469697030762821211 , _sage_const_12273613955114562522 , _sage_const_17259661581098255617 , _sage_const_16973225129691209572 , _sage_const_1671298410160447014 , _sage_const_2766666917229815482 , _sage_const_18152002698090042559 , _sage_const_6109896619580762394 , _sage_const_4424171998734786254 , _sage_const_14659121728155851846 , _sage_const_4021794363582100274 , _sage_const_1190070720064998876 , _sage_const_17113031305806140351 , _sage_const_7820767439185607712 , _sage_const_15761607804592599266 , _sage_const_10763736708310709923 , _sage_const_3652440110184888676 , _sage_const_16291849719008916140 , _sage_const_13531546450086099420 , _sage_const_10689944842290892320 , _sage_const_17550741367948958229 , _sage_const_5049524925867114490 , _sage_const_9085915584417350716 , _sage_const_2324128091746255319 , _sage_const_16182223945900014570 , _sage_const_12816883904370089749 , _sage_const_6338495201003790380 , _sage_const_690019768251267851 , _sage_const_11001203236598502930 , _sage_const_14483016109909577972 , _sage_const_3184981331538216080 , _sage_const_1953735306623729014 , _sage_const_3195912717810554853 , _sage_const_6727899073777700457 , _sage_const_14381881870900469873 , _sage_const_13948313970526077492 , _sage_const_1898363474447101142 , _sage_const_10158150047307123658 , _sage_const_3289353210223069781 , _sage_const_2924631213903838239 , _sage_const_12016550281043489442 , _sage_const_5288037825798194768 , _sage_const_1928511066588121966 , _sage_const_4262384579588166792 , _sage_const_8303760917298254875 , _sage_const_12691505544580951750 , _sage_const_10256275383962973353 , _sage_const_3231843563599501125 , _sage_const_14248865832675791448 , _sage_const_6248696301809803063 , _sage_const_13789104089182029495 , _sage_const_5843607658742135051 , _sage_const_17737777857298791677 , _sage_const_1619724124746087138 , _sage_const_14726661911679743991 , _sage_const_9857656590077387298 , _sage_const_6180484366290558943 , _sage_const_10323036535346379846 , _sage_const_15793517081317299253 , _sage_const_1266408713076512704 , _sage_const_16933434268416011523 , _sage_const_17261828307174336836 , _sage_const_13654271599404317376 , _sage_const_13402228851820876384 , _sage_const_2849994893206821249 , _sage_const_12151288158736186101 , _sage_const_1169145218531206836 , _sage_const_741819289445341678 , _sage_const_7734691436031090977 , _sage_const_11798452477212373740 , _sage_const_7154217834858219043 , _sage_const_17106406639752114760 , _sage_const_9038218857931263102 , _sage_const_17629303477546251171 , _sage_const_9561911214626190193 , _sage_const_5819230377587513481 , _sage_const_17692394905852954683 , _sage_const_16584678928098916908 , _sage_const_9552629934797441944 , _sage_const_1960578554505310312 , _sage_const_5314126755454229151 , _sage_const_10420019664327839774 , _sage_const_1920579974014384453 , _sage_const_11814572504873913467 , _sage_const_6813620197529319584 , _sage_const_14530818300613956521 , _sage_const_5717960335638514495 , _sage_const_1826089317315542084 , _sage_const_9746540325693920339 , _sage_const_12293903579751661981 , _sage_const_12072023852027505236 , _sage_const_4158161956491320192 , _sage_const_13187797178028234211 , _sage_const_10347220378338392049 , _sage_const_4109685635204129564 , _sage_const_17905396678924636242 , _sage_const_12816169692784168356 , _sage_const_3122202157254754454 , _sage_const_15049344592201270471 , _sage_const_11743069746039313118 , _sage_const_5518361885899535639 , _sage_const_5523064766773051210 , _sage_const_13099261390903694748 , _sage_const_15735208550749564724 , _sage_const_4954808013047354906 , _sage_const_8530172943937275951 , _sage_const_6039486853166908039 , _sage_const_17250917600359853056 , _sage_const_16884230491275901434 , _sage_const_7146627352729827385 , _sage_const_5377079253085891149 , _sage_const_11325711945158075346 , _sage_const_1175841450242341895 , _sage_const_3536321062507234995 , _sage_const_17987804153441270512 , _sage_const_13005249981618285105 , _sage_const_788148126685329522 , _sage_const_11570339277811300998 , _sage_const_18165650536299414961 , _sage_const_18232708859827982024 , _sage_const_16349646165263929134 , _sage_const_12066432301769178729 , _sage_const_6487193457298837072 , _sage_const_229428936786228159 , _sage_const_18318805619883399702 , _sage_const_7278903377176379701 , _sage_const_354652449667105449 , _sage_const_5081617143372943163 , _sage_const_7497558559813792697 , _sage_const_4724303652352827360 , _sage_const_14904849903329294870 , _sage_const_9654616591528403259 , _sage_const_7868294853033500304 , _sage_const_18377173560417505033 , _sage_const_6775725803195226959 , _sage_const_8023923270416842564 , _sage_const_16062558331775015600 , _sage_const_12622106697264283399 , _sage_const_16791480129290997618 , _sage_const_9642624528887989871 , _sage_const_5568699880367158460 , _sage_const_2292132947419875533 , _sage_const_2860843525364350878 , _sage_const_15044875604876382556 , _sage_const_2322206644710534986 , _sage_const_7994086170589054618 , _sage_const_18221232115843518168 , _sage_const_17932509913338872345 , _sage_const_16745957960550270253 , _sage_const_3041547535235218354 , _sage_const_6052294403885337831 , _sage_const_14097508762821320460 , _sage_const_7722979236945438530 , _sage_const_5412312762183033959 , _sage_const_4330257397020393615 , _sage_const_14066425088243174085 , _sage_const_5908415129829941105 , _sage_const_14613827790321653588 , _sage_const_10392847639868851184 , _sage_const_17319939956249493552 , _sage_const_5471647358638282398 , _sage_const_4323805273413622683 , _sage_const_45673835583717352 , _sage_const_2768951858098230386 , _sage_const_10533333615840814773 , _sage_const_5792976824891660247 , _sage_const_6760470939962645323 , _sage_const_12059043970688713392 , _sage_const_1141514292704724985 , _sage_const_14376006554387754613 , _sage_const_7848659205171623279 , _sage_const_2102102900942141192 , _sage_const_3226835475814606107 , _sage_const_14939040302529096563 , _sage_const_4886941580894909285 , _sage_const_16293689027031803210 , _sage_const_15262468573549282700 , _sage_const_10155481829793770459 , _sage_const_17540686337364843742 , _sage_const_9359123964020029075 , _sage_const_14341050618119309112 , _sage_const_12507168617459174171 , _sage_const_18130902956048423714 , _sage_const_13665444396961473675 , _sage_const_15046176000598795220 , _sage_const_17555217830165395083 , _sage_const_13911393252134719145 , _sage_const_7231927861169253028 , _sage_const_9656800224326818500 , _sage_const_16619073847145426834 , _sage_const_9362500945733192770 , _sage_const_16248043795163080710 , _sage_const_17119492047852061864 , _sage_const_3771777233785612247 , _sage_const_5066099564990360212 , _sage_const_6528217348327614459 , _sage_const_14557732355667791293 , _sage_const_3983967235049499954 , _sage_const_14972865518559772823 , _sage_const_18309892963862300370 , _sage_const_2702565340066128524 , _sage_const_14581826585510807404 , _sage_const_6785923105704665172 , _sage_const_3178783832504015555 , _sage_const_4487329387126092314 , _sage_const_14607659555773674854 , _sage_const_14611690777913540246 , _sage_const_8650469441940155399 , _sage_const_16395201898136500197 , _sage_const_17054554322277903942 , _sage_const_8808727791174901242 , _sage_const_4659912545766869753 , _sage_const_16280093529780582003 , _sage_const_8227777100883485324 , _sage_const_6391648914081892006 , _sage_const_8086830636050859321 , _sage_const_3036329342931530679 , _sage_const_9550803986416279819 , _sage_const_15723715638974760566 , _sage_const_3600131081381178995 , _sage_const_4213008057754089498 , _sage_const_7800227656146748278 , _sage_const_16093206001476543952 , _sage_const_34092242650846205 , _sage_const_10796394235992786784 , _sage_const_3737507590365686562 , _sage_const_4635293704024224739 , _sage_const_6248356048367582628 , _sage_const_58651963418898924 , _sage_const_7311945926270131048 , _sage_const_14172021054058588514 , _sage_const_786669623303546363 , _sage_const_13707605466632827662 , _sage_const_12652037425211239948 , _sage_const_3614621764645931879 , _sage_const_14219218441530235661 , _sage_const_17705085596277634153 , _sage_const_10999205772563189142 , _sage_const_14725863541120225273 , _sage_const_16572032274137847272 , _sage_const_7422663040433123398 , _sage_const_1367429326763685491 , _sage_const_18188880427089780784 , _sage_const_3020113589899409137 , _sage_const_17861326137394640984 , _sage_const_12811521970281811451 , _sage_const_9930017077979937986 , _sage_const_14010209903230004926 , _sage_const_14244903658037443384 , _sage_const_5104596873780686687 , _sage_const_6541450802991281799 , _sage_const_11274015481877303440 , _sage_const_9263644877386569901 , _sage_const_2094508980097214663 , _sage_const_9265217547056391424 , _sage_const_12891725173846409312 , _sage_const_7368085360949604417 , _sage_const_17218569647880682568 , _sage_const_971578709965983544 , _sage_const_18068295194496415202 , _sage_const_11447673531710052504 , _sage_const_1050990749156555294 , _sage_const_6617961706988870227 , _sage_const_8573699778506182520 , _sage_const_18351382407965474900 , _sage_const_11818212571937159515 , _sage_const_13279942519919393974 , _sage_const_2917195483987343542 , _sage_const_5267380285004415761 , _sage_const_6838848714000104164 , _sage_const_17641263518300288598 , _sage_const_2215745899135842567 , _sage_const_12801347909799411794 , _sage_const_10290562142964170536 , _sage_const_7914162112720597371 , _sage_const_887945320632678796 , _sage_const_7498884365341905591 , _sage_const_6837169369110795546 , _sage_const_12081337382906878940 , _sage_const_10170622662080121124 , _sage_const_4164483125943285453 , _sage_const_16714749428117493289 , _sage_const_6397906319726017667 , _sage_const_17269200682146128380 , _sage_const_7643408118607526902 , _sage_const_13606395898320721039 , _sage_const_3995636887459959022 , _sage_const_2399445660061961468 , _sage_const_3356471279068499315 , _sage_const_17457407818660850527 , _sage_const_8387841308984493141 , _sage_const_9827685184581644270 , _sage_const_122379904170852775 , _sage_const_6361209092488635527 , _sage_const_10367030262445106875 , _sage_const_6815142494923282099 , _sage_const_12700609328551660665 , _sage_const_12995076509576312783 , _sage_const_4314859466640917306 , _sage_const_7425591798559758436 , _sage_const_4258930916333954548 , _sage_const_12756686654123292952 , _sage_const_4264489197639561415 , _sage_const_15190066733707627825 , _sage_const_2083158051121733889 ]
    correct_coef = [[(correct_state[i] >> j) & _sage_const_1  for j in range(_sage_const_64 )] for i in range(len(correct_state))]
    correct_coef = sum(correct_coef, [])
    correct_coef = vector(GF(_sage_const_2 ), correct_coef)

    coef_mat = Matrix(GF(_sage_const_2 ), len(bits) - _sage_const_64 , _sage_const_312  * _sage_const_64 )
    rhs = vector(GF(_sage_const_2 ), len(bits) - _sage_const_64 , bits[_sage_const_64 :])

    print("Calculating coefficients", flush=True)
    idx = _sage_const_0 
    for i in range(len(bits)):
    # for i in range(1000):
        if idx == _sage_const_0 :
            twist()
        
        y = state[idx]
        idx = (idx + _sage_const_1 ) % _sage_const_312 
        if bits[i] is None:
            continue
        
        y = _process_vec(y)
        msb = y[_sage_const_63 ]

        calculated = sum(correct_coef[k] for k in msb) % _sage_const_2 
        # print(f"[{i:<5}]", calculated, "==", bits[i], flush=True)
        assert calculated == bits[i]

        if idx == _sage_const_0 :
            print(f"[{i:<5}]", msb, "==", bits[i], flush=True)

        # extract coefficients from msb
        for k in msb:
            coef_mat[i - _sage_const_64 , k] = _sage_const_1 

    print("TESTING")
    correct_recover = ''.join(map(str, rhs[_sage_const_64 :_sage_const_1000 ]))
    our_recover = ''.join(map(str, (coef_mat * correct_coef)[_sage_const_64 :_sage_const_1000 ]))
    print("Correct:", correct_recover)
    print(" We got:", our_recover)
    assert correct_recover == our_recover

    # dump coefficients
    print("Started dumping coefficients...", flush=True)
    coef_str = str(coef_mat)
    print("Length:", len(coef_str), flush=True)
    with open("dump", "w") as fout:
        fout.write(coef_str)
    
    print("Started solving equations...", flush=True)

    res = coef_mat.solve_right(rhs)
    print("solution:", res, flush=True)

    ker = coef_mat.right_kernel()
    print("kernel:", ker, flush=True)

    # for ker in coef_mat.right_kernel():
    #     print(res + ker, flush=True)

    # state = [vec_to_int64(x) for x in state]
    # assert _process_vec(state[0]) == int64_to_vec(10331993320712037408), f"{_process(state[0])} != 10331993320712037408"

if __name__ == "__main__":
    main()

